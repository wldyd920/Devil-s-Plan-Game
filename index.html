<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìˆ˜ì‹ í”¼ë¼ë¯¸ë“œ ê²Œì„</title>
  <style>
    /* Global Styles */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e1f26, #2a2d39);
      color: #f1f1f1;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }
    h1 {
      width: 100%;
      text-align: center;
      background: #272b33;
      font-size: 2rem;
      padding: 20px 0;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
    }
    .game-container {
      display: flex;
      width: 90%;
      max-width: 1200px;
      margin: 20px 0;
      background: rgba(40, 44, 52, 0.8);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.7);
    }
    /* History Panel */
    .history {
      width: 280px;
      background: rgba(50, 54, 63, 0.9);
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    .history h3 {
      margin-bottom: 10px;
      font-size: 1.2rem;
      color: #ffb74d;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    .history p {
      margin: 5px 0;
      font-size: 1rem;
    }
    .history ul {
      list-style: none;
      margin-top: 10px;
      width: 100%;
      max-height: 120px;
      overflow-y: auto;
    }
    .history ul li {
      background: rgba(80, 84, 92, 0.7);
      margin-bottom: 6px;
      padding: 6px 8px;
      border-radius: 4px;
      font-weight: bold;
      text-align: center;
      color: #e0f7fa;
    }
    .remaining {
      width: 100%;
      margin-top: auto;
      background: rgba(60, 64, 73, 0.9);
      padding: 10px;
      border-radius: 8px;
      margin-top: 15px;
    }
    .remaining h4 {
      margin-bottom: 8px;
      font-size: 1rem;
      color: #4dd0e1;
    }
    .remaining ul {
      list-style: none;
      max-height: 100px;
      overflow-y: auto;
    }
    .remaining ul li {
      background: rgba(90, 94, 103, 0.7);
      margin-bottom: 4px;
      padding: 4px 6px;
      border-radius: 4px;
      font-size: 0.9rem;
      color: #b2ebf2;
    }
    /* Main Game Panel */
    .main-game {
      flex: 1;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
    }
    .target-box {
      background: #ffca28;
      color: #212121;
      font-size: 1.5rem;
      font-weight: 600;
      padding: 12px 24px;
      border-radius: 50px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
      margin-bottom: 20px;
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    .pyramid {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
    }
    .row {
      display: flex;
      justify-content: center;
      margin: -40px 0;
    }
    .cell {
      width: 80px;
      height: 90px;
      background: linear-gradient(145deg, #e0e0e0, #ffffff);
      margin: 30px;
      position: relative;
      clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      border-radius: 8px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .cell:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.4);
    }
    .label {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 20px;
      background: #00796b;
      color: #ffffff;
      font-size: 14px;
      font-weight: bold;
      display: flex;
      align-items: center;
      justify-content: center;
      border-top-left-radius: 6px;
      border-top-right-radius: 6px;
    }
    .value {
      font-size: 24px;
      font-weight: 700;
      color: #d84315;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
      margin-top: 10px;
    }
    .selected {
      background: #ffeb3b;
      box-shadow: 0 0 10px #ffeb3b;
      transform: translateY(-5px);
    }
    #result {
      font-size: 1.1rem;
      margin: 10px;
      color: #ffab00;
      min-height: 24px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }
    .button-group {
      margin-top: 10px;
      display: flex;
      gap: 10px;
    }
    .button-group button {
      padding: 10px 20px;
      font-size: 1rem;
      font-weight: bold;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
    }
    .reset-button {
      background: #66bb6a;
      color: #ffffff;
    }
    .reset-button:hover {
      background: #43a047;
      transform: scale(1.05);
    }
    .end-button {
      background: #ef5350;
      color: #ffffff;
    }
    .end-button:hover {
      background: #c62828;
      transform: scale(1.05);
    }
    .restart-button {
      position: absolute;
      bottom: 20px;
      left: 20px;
      padding: 8px 16px;
      font-size: 0.9rem;
      background: #29b6f6;
      color: #ffffff;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
    }
    .restart-button:hover {
      background: #0288d1;
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <h1>ìˆ˜ì‹ í”¼ë¼ë¯¸ë“œ ê²Œì„</h1>
  <div class="game-container">
    <div class="history">
      <h3>ê²Œì„ í˜„í™©</h3>
      <p id="score-display">ì ìˆ˜: 0</p>
      <p id="answer-count">ì´ í•´ë‹µ ìˆ˜: 0</p>
      <p id="total-solutions">ê°€ëŠ¥í•œ ì •ë‹µ ìˆ˜: ê³„ì‚° ì¤‘.</p>
      <h3>ë‚˜ì˜¨ ì •ë‹µ:</h3>
      <ul id="history-list"></ul>
      <div class="remaining">
        <h4>ë‚¨ì€ ì •ë‹µë“¤:</h4>
        <ul id="remaining-list"></ul>
      </div>
    </div>
    <div class="main-game">
      <div class="target-box" id="target">ğŸ¯ TARGET: 12</div>
      <div class="pyramid" id="pyramid"></div>
      <div id="result"></div>
      <div class="button-group">
        <button class="reset-button" onclick="resetSelection()">ì„ íƒ ë¦¬ì…‹</button>
        <button class="end-button" onclick="endGame()">ê²Œì„ ì¢…ë£Œ</button>
      </div>
      <button class="restart-button" onclick="restartGame()">ê²Œì„ ë¦¬ìŠ¤íƒ€íŠ¸</button>
    </div>
  </div>

  <script>
    let cellsData = [];
    let selected = [];
    let history = new Set();
    let targetNumber = 12;
    let score = 0;
    let gameOver = false;

    const operators = ['+', '-', '*', '/'];

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function generateCells() {
      const letters = 'ABCDEFGHIJ'.split('');
      let list = [];
      let seenPairs = new Set();
      while (list.length < 10) {
        let val = getRandomInt(1, 10);
        let op = operators[Math.floor(Math.random() * operators.length)];
        let key = `${op}${val}`;
        if (seenPairs.has(key)) continue;
        seenPairs.add(key);
        list.push({ letter: letters[list.length], val: val, op: op });
      }
      return list;
    }

    function buildPyramid() {
      const pyramid = document.getElementById('pyramid');
      pyramid.innerHTML = '';
      let index = 0;
      for (let row = 1; row <= 4; row++) {
        const rowEl = document.createElement('div');
        rowEl.className = 'row';
        for (let i = 0; i < row; i++) {
          const cell = cellsData[index];
          const cellEl = document.createElement('div');
          cellEl.className = 'cell';
          cellEl.dataset.index = index;

          const labelEl = document.createElement('div');
          labelEl.className = 'label';
          labelEl.innerText = cell.letter;

          const valueEl = document.createElement('div');
          valueEl.className = 'value';
          const symbol = cell.op === '*' ? 'Ã—' : cell.op === '/' ? 'Ã·' : cell.op;
          valueEl.innerText = `${symbol}${cell.val}`;

          cellEl.appendChild(labelEl);
          cellEl.appendChild(valueEl);

          cellEl.addEventListener('click', () => selectCell(cellEl));
          rowEl.appendChild(cellEl);
          index++;
        }
        pyramid.appendChild(rowEl);
      }
    }

    function selectCell(cellEl) {
      if (gameOver) return;
      if (cellEl.classList.contains('selected')) {
        cellEl.classList.remove('selected');
        selected = selected.filter(c => c !== cellEl);
      } else {
        if (selected.length < 3) {
          cellEl.classList.add('selected');
          selected.push(cellEl);
        }
      }
      if (selected.length === 3) calculateResult();
    }

    function calculateResult() {
      const indices = selected.map(c => parseInt(c.dataset.index));
      const values = indices.map(i => cellsData[i]);
      const key = indices.map(i => cellsData[i].letter).join('');

      if (history.has(key)) {
        document.getElementById('result').innerText = 'âŒ ì´ë¯¸ ì‹œë„í•œ ì¡°í•©ì…ë‹ˆë‹¤ (-1ì )';
        score--;
        document.getElementById('score-display').innerText = `ì ìˆ˜: ${score}`;
        selected.forEach(c => c.classList.remove('selected'));
        selected = [];
        return;
      }

      let result = values[0].val;
      result = eval(`${result} ${values[1].op} ${values[1].val}`);
      result = eval(`${result} ${values[2].op} ${values[2].val}`);

      if (Math.round(result) === targetNumber) {
        score++;
        document.getElementById('score-display').innerText = `ì ìˆ˜: ${score}`;
        document.getElementById('result').innerText = 'âœ… ì •ë‹µì…ë‹ˆë‹¤! (+1ì )';
        document.getElementById('history-list').innerHTML += `<li>${key}</li>`;
        history.add(key);
        document.getElementById('answer-count').innerText = `ì´ í•´ë‹µ ìˆ˜: ${history.size}`;
      } else {
        document.getElementById('result').innerText = 'âŒ ì˜¤ë‹µì…ë‹ˆë‹¤ (-1ì )';
        score--;
        document.getElementById('score-display').innerText = `ì ìˆ˜: ${score}`;
      }

      selected.forEach(c => c.classList.remove('selected'));
      selected = [];
    }

    function resetSelection() {
      if (gameOver) return;
      selected.forEach(c => c.classList.remove('selected'));
      selected = [];
    }

    function restartGame() {
      gameOver = false;
      document.getElementById('remaining-list').innerHTML = '';
      function countValidSolutions() {
        let count = 0;
        for (let i = 0; i < 10; i++) {
          for (let j = 0; j < 10; j++) {
            for (let k = 0; k < 10; k++) {
              if (i === j || j === k || i === k) continue;
              let a = cellsData[i];
              let b = cellsData[j];
              let c = cellsData[k];
              let temp1 = eval(`${a.val} ${b.op} ${b.val}`);
              let temp2 = eval(`${temp1} ${c.op} ${c.val}`);
              if (Math.round(temp2) === targetNumber) {
                count++;
              }
            }
          }
        }
        return count;
      }

      let validCount = 0;
      do {
        cellsData = generateCells();
        targetNumber = getRandomInt(-20, 20);
        validCount = countValidSolutions();
      } while (validCount === 0);

      selected = [];
      history = new Set();
      document.getElementById('history-list').innerHTML = '';
      score = 0;
      document.getElementById('score-display').innerText = 'ì ìˆ˜: 0';
      document.getElementById('answer-count').innerText = 'ì´ í•´ë‹µ ìˆ˜: 0';
      document.getElementById('total-solutions').innerText = `ê°€ëŠ¥í•œ ì •ë‹µ ìˆ˜: ${validCount}`;

      document.getElementById('target').innerText = `ğŸ¯ TARGET: ${targetNumber}`;
      buildPyramid();
      document.getElementById('result').innerText = '';
    }

    function endGame() {
      if (gameOver) return;
      gameOver = true;
      let allKeys = new Set();
      for (let i = 0; i < 10; i++) {
        for (let j = 0; j < 10; j++) {
          for (let k = 0; k < 10; k++) {
            if (i === j || j === k || i === k) continue;
            let a = cellsData[i];
            let b = cellsData[j];
            let c = cellsData[k];
            let temp1 = eval(`${a.val} ${b.op} ${b.val}`);
            let temp2 = eval(`${temp1} ${c.op} ${c.val}`);
            if (Math.round(temp2) === targetNumber) {
              let key = a.letter + b.letter + c.letter;
              allKeys.add(key);
            }
          }
        }
      }
      const remaining = Array.from(allKeys).filter(key => !history.has(key));
      const remListEl = document.getElementById('remaining-list');
      remListEl.innerHTML = '';
      if (remaining.length === 0) {
        remListEl.innerHTML = '<li>ë‚¨ì€ ì •ë‹µì´ ì—†ìŠµë‹ˆë‹¤.</li>';
      } else {
        remaining.forEach(key => {
          remListEl.innerHTML += `<li>${key}</li>`;
        });
      }
      document.getElementById('result').innerText = 'ğŸ® ê²Œì„ ì¢…ë£Œ! ë‚¨ì€ ì •ë‹µì„ í™•ì¸í•˜ì„¸ìš”.';
    }

    // ì´ˆê¸° ê²Œì„ ì‹œì‘
    restartGame();
  </script>
</body>
</html>
