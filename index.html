<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>수식 피라미드 게임</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      background: #3a3a3a;
      color: #f0f0f0;
      margin: 0;
      padding: 0;
    }
    .game-container {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      padding: 20px;
    }
    .history {
      width: 150px;
      text-align: left;
      background: #222;
      padding: 10px;
      border-radius: 8px;
    }
    .history h3 {
      color: #ffc107;
    }
    .history ul {
      list-style: none;
      padding-left: 0;
    }
    .pyramid {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-top: 20px;
    }
    .row {
      display: flex;
      justify-content: center;
      margin: 5px;
    }
    .cell {
      width: 70px;
      height: 40.41px;
      background: #e6e1d5;
      border: 3px solid #b8a76c;
      margin: 2px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 18px;
      position: relative;
      clip-path: polygon(
        50% 0%,
        93% 25%,
        93% 75%,
        50% 100%,
        7% 75%,
        7% 25%
      );
      box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
      cursor: pointer;
    }
    .selected {
      background: #ffe066;
      border-color: #c9a800;
    }
    #target {
      font-size: 24px;
      font-weight: bold;
      background: #6c757d;
      border: 2px solid #333;
      padding: 10px;
      border-radius: 6px;
      margin: 20px auto;
      width: 200px;
    }
    .controls {
      display: flex;
      justify-content: space-around;
      margin: 20px;
    }
    button {
      padding: 10px 20px;
      border: none;
      background: #17a2b8;
      color: white;
      font-size: 16px;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background: #138496;
    }
    #result {
      font-size: 20px;
      margin: 10px;
    }
  </style>
</head>
<body>
  <h1>수식 피라미드 게임</h1>
  <div class="game-container">
    <div class="history">
      <h3>해답 기록</h3>
      <ul id="history-list"></ul>
    </div>
    <div>
      <div id="target">🎯 TARGET: 12</div>
      <div class="pyramid" id="pyramid"></div>
      <div id="result"></div>
      <div class="controls">
        <button onclick="resetSelection()">선택 리셋</button>
        <button onclick="restartGame()">게임 리스타트</button>
      </div>
    </div>
  </div>
  <script>
    let cellsData = [];
    let selected = [];
    let history = new Set();
    let targetNumber = 12;

    const operators = ['+', '-', '*', '/'];

    function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function generateCells() {
      const letters = 'ABCDEFGHIJ'.split('');
      let list = [];
      while (list.length < 10) {
        let val = getRandomInt(-20, 20);
        let op = operators[Math.floor(Math.random() * operators.length)];
        list.push({
          letter: letters[list.length],
          val: val,
          op: op
        });
      }
      return list;
    }

    function buildPyramid() {
      const pyramid = document.getElementById('pyramid');
      pyramid.innerHTML = '';
      let index = 0;
      for (let row = 1; row <= 4; row++) {
        const rowEl = document.createElement('div');
        rowEl.className = 'row';
        for (let i = 0; i < row; i++) {
          const cell = cellsData[index];
          const cellEl = document.createElement('div');
          cellEl.className = 'cell';
          cellEl.dataset.index = index;
          cellEl.innerText = `${cell.op}${cell.val}\n(${cell.letter})`;
          cellEl.addEventListener('click', () => selectCell(cellEl));
          rowEl.appendChild(cellEl);
          index++;
        }
        pyramid.appendChild(rowEl);
      }
    }

    function selectCell(cellEl) {
      if (cellEl.classList.contains('selected')) {
        cellEl.classList.remove('selected');
        selected = selected.filter(c => c !== cellEl);
      } else {
        if (selected.length < 3) {
          cellEl.classList.add('selected');
          selected.push(cellEl);
        }
      }
      if (selected.length === 3) calculateResult();
    }

    function calculateResult() {
      const indices = selected.map(c => parseInt(c.dataset.index));
      const values = indices.map(i => cellsData[i]);
      const key = values.map(v => v.letter).join('');
      if (history.has(key)) {
        document.getElementById('result').innerText = '❌ 이미 시도한 조합입니다 (-1점)';
        selected.forEach(c => c.classList.remove('selected'));
        selected = [];
        return;
      }

      let num = values[0].val;
      let result = eval(`${num} ${values[1].op} ${values[1].val}`);
      result = eval(`${result} ${values[2].op} ${values[2].val}`);

      if (Math.round(result) === targetNumber) {
        document.getElementById('result').innerText = '✅ 정답입니다! (+1점)';
        document.getElementById('history-list').innerHTML += `<li>${key}</li>`;
        history.add(key);
      } else {
        document.getElementById('result').innerText = '❌ 오답입니다 (-1점)';
      }

      selected.forEach(c => c.classList.remove('selected'));
      selected = [];
    }

    function resetSelection() {
      selected.forEach(c => c.classList.remove('selected'));
      selected = [];
    }

    function restartGame() {
      cellsData = generateCells();
      selected = [];
      history = new Set();
      document.getElementById('history-list').innerHTML = '';
      targetNumber = getRandomInt(-20, 20);
      document.getElementById('target').innerText = `🎯 TARGET: ${targetNumber}`;
      buildPyramid();
      document.getElementById('result').innerText = '';
    }

    // 초기 시작
    restartGame();
  </script>
</body>
</html>
